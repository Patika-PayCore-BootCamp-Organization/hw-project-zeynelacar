--table schemas
DROP TABLE IF EXISTS blocks;
DROP TABLE IF EXISTS flats;
DROP TABLE IF EXISTS tenants;
DROP TABLE IF EXISTS payments;
DROP TABLE IF EXISTS fees;

CREATE TABLE blocks
(
    id INT GENERATED BY DEFAULT AS PRIMARY KEY,
    name VARCHAR(10) NOT NULL
);

CREATE TABLE flats
(
    id INT GENERATED BY DEFAULT AS PRIMARY KEY,
    flat_number INT NOT NULL,
    block_id INT NOT NULL,
    --debt INT DEFAULT 0,
    payment_id INT NOT NULL,
    FOREIGN KEY(block_id) REFERENCES blocks(id),
    FOREIGN KEY(payment_id) REFERENCES payments(id),

);

CREATE TABLE payments
(
    id INT GENERATED BY DEFAULT AS PRIMARY KEY,
    --block_name VARCHAR(10) NOT NULL,
    flat_id INT NOT NULL,
    total_fee INT NOT NULL,
    payment_date DATE NOT NULL,
    payment_amount INT NOT NULL,
    --debt ,
    --FOREIGN KEY(block_name) REFERENCES blocks(name),
    FOREIGN KEY(flat_id) REFERENCES flats(id),
    FOREIGN KEY(total_fee) REFERENCES fees(total_fee),

);

CREATE TABLE fees
(
    id INT GENERATED BY DEFAULT AS PRIMARY KEY,
    flat_id INT NOT NULL,
    electricity_bill INT DEFAULT 0,
    gas_bill INT DEFAULT 0,
    water_bill INT DEFAULT 0,
    dues INT DEFAULT 0,
    total_fee GENERATED ALWAYS AS SUM SELECT ,electricity_bill,gas_bill,water_bill,dues,flat_debt FROM fees,
    flat_debt INT DEFAULT 0,
    FOREIGN KEY(flat_id) REFERENCES flats(id);
);


CREATE TABLE tenants
(
    id INT GENERATED BY DEFAULT AS PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    surname VARCHAR(50) NOT NULL,
    block_id INT NOT NULL,
    flat_id INT NOT NULL,
    personal_payment INT DEFAULT 0,
    --debt INT DEFAULT 0,
    FOREIGN KEY(block_id) REFERENCES blocks(id),
    FOREIGN KEY(flat_id) REFERENCES flats(id),
    --FOREIGN KEY(debt) REFERENCES flats(debt)
);

INSERT INTO blocks(name)
VALUES ('A1'),
       ('A2'),
       ('B1'),
       ('B2'),
       ('C');

INSERT INTO fees(flat_id,electricity_bill,gas_bill,water_bill,dues,flat_debt)
VALUES (1,100,100,100,50,10),
       (2,100,100,100,50,10),
       (3,100,100,100,50,10),
       (4,100,100,100,50,10),
       (5,100,100,100,50,10),
       (6,100,100,100,50,10),
       (7,100,100,100,50,10);


INSERT INTO flats(flat_number,block_id,payment_id)
VALUES (1,1,1),
       (2,1,2),
       (1,2,3),
       (2,2,4),
       (1,3,5),
       (1,4,6),
       (1,5,7);

